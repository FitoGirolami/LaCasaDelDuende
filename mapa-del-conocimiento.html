<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Casa del Duende ‚Äî Mapa del Conocimiento | Duendismo Cultural (Ba√±os, Ecuador)</title>
    <meta name="description" content="Descubre tu nivel de conocimiento sobre el simbolismo de los duendes. Una herramienta educativa de La Casa del Duende para distinguir entre superstici√≥n, tradici√≥n y arte.">
    <link rel="canonical" href="https://lacasadelduende.art/mapa-del-conocimiento.html">
    
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://lacasadelduende.art/">
    <meta property="og:title" content="La Casa del Duende ‚Äî Mapa del Conocimiento">
    <meta property="og:description" content="Creer no es lo mismo que conocer. Realiza el diagn√≥stico cultural y descubre tu posici√≥n en la pir√°mide del conocimiento.">
    <meta property="og:image" content="https://lacasadelduende.art/assets/share-image.jpg">

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "CulturalOrganization",
      "name": "La Casa del Duende",
      "url": "https://lacasadelduende.art/",
      "logo": "https://lacasadelduende.art/logo.png",
      "sameAs": [
        "https://www.facebook.com/lacasadelduendebanos",
        "https://www.instagram.com/lacasadelduende"
      ],
      "description": "Espacio dedicado al Duendismo Cultural, la educaci√≥n simb√≥lica, arte y archivo en Ba√±os de Agua Santa.",
      "address": {
        "@type": "PostalAddress",
        "addressLocality": "Ba√±os de Agua Santa",
        "addressRegion": "Tungurahua",
        "addressCountry": "EC"
      },
      "knowsAbout": ["Duendismo Cultural", "Folklore Ecuatoriano", "Antropolog√≠a Simb√≥lica"]
    }
    </script>

    <style>
        :root {
            /* Paleta: Museo / Tierra / Papel */
            --bg-paper: #f9f7f2;
            --text-ink: #2b2b2b;
            --text-light: #66605b;
            --accent-gold: #cfa86e;
            --border-color: #e0ddd5;
            
            /* TEOR√çA DEL COLOR (Espectro visible: Rojo denso -> Violeta elevado) */
            --lvl-1: #b71c1c; /* Rojo: Instinto / Superstici√≥n */
            --lvl-2: #e65100; /* Naranja: Emoci√≥n / Rumor */
            --lvl-3: #f9a825; /* Amarillo Ocre: Ego / Subjetivo */
            --lvl-4: #2e7d32; /* Verde: Naturaleza / Arte */
            --lvl-5: #1565c0; /* Azul: Comunicaci√≥n / Tradici√≥n */
            --lvl-6: #6a1b9a; /* Violeta: Sabidur√≠a / Conocimiento */

            --font-heading: 'Georgia', 'Times New Roman', serif;
            --font-body: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
            
            --shadow-card: 0 4px 12px rgba(0,0,0,0.06);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background-color: var(--bg-paper);
            color: var(--text-ink);
            font-family: var(--font-body);
            line-height: 1.6;
            transition: background 0.3s ease;
        }

        /* --- Header --- */
        header {
            text-align: center;
            padding: 3rem 1rem;
            border-bottom: 1px solid var(--border-color);
            position: relative;
            background: #fff;
        }
        h1 {
            font-family: var(--font-heading);
            font-size: 2.2rem;
            letter-spacing: -0.5px;
            margin-bottom: 0.5rem;
        }
        .subtitle {
            font-style: italic;
            color: var(--text-light);
            font-size: 1.1rem;
        }

        /* --- Toggle Switch --- */
        .mode-toggle-container {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.85rem;
            background: var(--bg-paper);
            padding: 8px 12px;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            z-index: 100;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 20px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 14px;
            width: 14px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--text-ink); }
        input:checked + .slider:before { transform: translateX(20px); }

        /* --- Main Container --- */
        main {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        /* --- Pyramid Section --- */
        .pyramid-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 4rem;
        }
        .pyramid-svg {
            width: 100%;
            max-width: 500px;
            height: auto;
            overflow: visible;
        }
        .pyramid-layer {
            cursor: pointer;
            transition: opacity 0.3s, transform 0.2s;
        }
        .pyramid-layer:hover {
            opacity: 0.85;
            transform: scale(1.01);
        }
        .tooltip-box {
            min-height: 100px;
            width: 100%;
            max-width: 600px;
            margin-top: 1rem;
            padding: 1.5rem;
            background: #fff;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-card);
            border-radius: 4px;
            text-align: center;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
        }
        .tooltip-box.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* --- Quiz Section --- */
        .quiz-container {
            background: #fff;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: var(--shadow-card);
            border: 1px solid var(--border-color);
        }
        .question-block {
            margin-bottom: 2.5rem;
            border-bottom: 1px solid #f0f0f0;
            padding-bottom: 1.5rem;
        }
        .question-title {
            font-family: var(--font-heading);
            font-size: 1.25rem;
            margin-bottom: 1rem;
            color: var(--text-ink);
        }
        .options-group label {
            display: block;
            margin-bottom: 0.8rem;
            cursor: pointer;
            padding: 10px;
            border-radius: 4px;
            transition: background 0.2s;
        }
        .options-group label:hover {
            background-color: #f4f4f0;
        }
        .options-group input {
            margin-right: 10px;
            accent-color: var(--text-ink);
        }

        /* --- Buttons --- */
        .btn {
            background-color: var(--text-ink);
            color: #fff;
            border: none;
            padding: 12px 24px;
            font-size: 1rem;
            font-family: var(--font-body);
            cursor: pointer;
            border-radius: 2px;
            transition: background 0.3s;
        }
        .btn:hover { background-color: #4a4a4a; }
        .btn-outline {
            background: transparent;
            border: 1px solid var(--text-ink);
            color: var(--text-ink);
        }
        .btn-outline:hover { background: #f0f0f0; }

        /* --- Results Section --- */
        .results-section {
            display: none; /* Hidden by default */
            animation: fadeIn 0.6s ease;
        }
        .result-header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem;
            background: #fff;
            border: 1px solid var(--border-color);
        }
        .level-badge {
            display: inline-block;
            padding: 0.5rem 1.5rem;
            margin-top: 1rem;
            color: white;
            font-weight: bold;
            border-radius: 50px;
            font-family: var(--font-heading);
            font-size: 1.5rem;
        }

        /* --- CHART SECTION (ESTAD√çSTICAS) --- */
        .chart-container {
            margin: 2rem 0;
            padding: 1.5rem;
            background: #fafafa;
            border-radius: 8px;
            border: 1px solid #eee;
        }
        .chart-title {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #666;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        .bar-chart {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 160px;
            gap: 6px;
        }
        .bar-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 14%;
        }
        .bar {
            width: 100%;
            border-radius: 4px 4px 0 0;
            transition: height 1s ease;
            position: relative;
            opacity: 0.4; /* Barras apagadas por defecto */
        }
        .bar.active {
            opacity: 1; /* Barra del usuario resaltada */
            box-shadow: 0 0 10px rgba(0,0,0,0.15);
            border: 2px solid #333;
        }
        .bar-label {
            font-size: 0.75rem;
            margin-top: 5px;
            color: #555;
            font-weight: bold;
        }
        .bar-value {
            font-size: 0.7rem;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }

        /* Learning Paths */
        .paths-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }
        .path-card {
            background: #fff;
            padding: 2rem;
            border-top: 4px solid #ccc;
            box-shadow: var(--shadow-card);
        }
        .path-card.grow { border-color: var(--lvl-6); }
        .path-card.stay { border-color: var(--lvl-1); }

        .path-title {
            font-family: var(--font-heading);
            margin-bottom: 1rem;
            font-size: 1.4rem;
        }
        
        /* Lists */
        ul.styled-list {
            list-style: none;
            padding: 0;
        }
        ul.styled-list li {
            margin-bottom: 0.8rem;
            padding-left: 1.5rem;
            position: relative;
        }
        ul.styled-list li::before {
            content: "‚Äî";
            position: absolute;
            left: 0;
            color: var(--accent-gold);
        }

        /* Text Modes (Museo vs Aula) */
        .mode-aula { display: none; margin-top: 0.5rem; font-size: 0.95rem; color: #555; border-left: 2px solid var(--accent-gold); padding-left: 10px; }
        .mode-museo { display: block; }
        
        body.show-aula .mode-aula { display: block; }

        /* Footer */
        footer {
            text-align: center;
            padding: 3rem;
            font-size: 0.9rem;
            color: var(--text-light);
            border-top: 1px solid var(--border-color);
            background: #fff;
            margin-top: 4rem;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .paths-grid { grid-template-columns: 1fr; }
            h1 { font-size: 1.8rem; }
            .mode-toggle-container { position: relative; top: 0; right: 0; margin-bottom: 1rem; justify-content: center; background: transparent; border: none; }
        }

        /* --- PRINT CSS --- */
        @media print {
            .mode-toggle-container, .btn, .quiz-container { display: none !important; }
            .results-section { display: block !important; }
            body { background: white; color: black; font-size: 12pt; }
            header { border-bottom: 2px solid black; padding: 1rem 0; }
            .path-card { border: 1px solid #ccc; break-inside: avoid; box-shadow: none; margin-bottom: 2rem; }
            .pyramid-svg { max-height: 200px; margin: 0 auto; display: block; }
            a { text-decoration: none; color: black; }
            .subtitle::after { content: " | lacasadelduende.art"; }
            .bar-chart { height: 100px; }
        }
    </style>
</head>
<body class="show-museo">

    <header>
        <div class="mode-toggle-container">
            <span id="mode-text">Modo Museo (Breve)</span>
            <label class="switch">
                <input type="checkbox" id="modeToggle">
                <span class="slider"></span>
            </label>
        </div>
        <h1>La Casa del Duende</h1>
        <div class="subtitle">Mapa del Conocimiento: Teor√≠a del Color</div>
    </header>

    <main>
        <section class="pyramid-wrapper">
            <div id="pyramid-tooltip" class="tooltip-box">
                <p style="font-style: italic; color: #888;">Interact√∫a con la pir√°mide o realiza el test para ubicarte.</p>
            </div>

            <svg class="pyramid-svg" viewBox="0 0 500 450" xmlns="http://www.w3.org/2000/svg">
                <polygon points="250,20 300,80 200,80" fill="var(--lvl-6)" class="pyramid-layer" data-lvl="6" />
                <text x="250" y="70" text-anchor="middle" fill="white" font-size="12" font-family="sans-serif" pointer-events="none">6. Documentado</text>

                <polygon points="200,82 300,82 340,140 160,140" fill="var(--lvl-5)" class="pyramid-layer" data-lvl="5" />
                <text x="250" y="125" text-anchor="middle" fill="white" font-size="12" font-family="sans-serif" pointer-events="none">5. Tradici√≥n Oral</text>

                <polygon points="160,142 340,142 380,200 120,200" fill="var(--lvl-4)" class="pyramid-layer" data-lvl="4" />
                <text x="250" y="185" text-anchor="middle" fill="white" font-size="12" font-family="sans-serif" pointer-events="none">4. Arte / Duendismo</text>

                <polygon points="120,202 380,202 420,260 80,260" fill="var(--lvl-3)" class="pyramid-layer" data-lvl="3" />
                <text x="250" y="245" text-anchor="middle" fill="black" font-size="12" font-family="sans-serif" pointer-events="none">3. Subjetivo</text>

                <polygon points="80,262 420,262 460,320 40,320" fill="var(--lvl-2)" class="pyramid-layer" data-lvl="2" />
                <text x="250" y="305" text-anchor="middle" fill="white" font-size="12" font-family="sans-serif" pointer-events="none">2. Rumor</text>

                <polygon points="40,322 460,322 500,380 0,380" fill="var(--lvl-1)" class="pyramid-layer" data-lvl="1" />
                <text x="250" y="365" text-anchor="middle" fill="white" font-size="12" font-family="sans-serif" pointer-events="none">1. Superstici√≥n</text>

                <g id="user-marker" style="display:none; transition: transform 1s ease;">
                    <path d="M0,0 L15,8 L0,16 Z" fill="#2b2b2b" transform="translate(460, 0)"/>
                    <text x="480" y="12" font-size="14" font-weight="bold" fill="#2b2b2b">T√ö</text>
                    <line x1="460" y1="8" x2="350" y2="8" stroke="#2b2b2b" stroke-dasharray="4"/>
                </g>
            </svg>
        </section>

        <section id="quiz-section" class="quiz-container">
            <h2 style="font-family: var(--font-heading); margin-bottom: 1.5rem; text-align: center;">Diagn√≥stico de Conocimiento Simb√≥lico</h2>
            <form id="quiz-form"></form>
            <div style="text-align: center; margin-top: 2rem;">
                <button type="button" class="btn" onclick="calculateResults()">Ver mi nivel</button>
            </div>
        </section>

        <section id="results-section" class="results-section">
            <div class="result-header">
                <h3>Tu diagn√≥stico cultural:</h3>
                <div id="result-badge" class="level-badge">CALCULANDO...</div>
                <p class="mode-museo" id="result-desc-short" style="margin-top: 1rem;"></p>
                <p class="mode-aula" id="result-desc-long"></p>

                <div class="chart-container">
                    <div class="chart-title">Visitantes en este dispositivo (Memoria Acumulativa)</div>
                    <div class="bar-chart" id="distribution-chart">
                        </div>
                    <p style="font-size: 0.8rem; color: #888; margin-top: 15px; font-style: italic;" id="chart-footer">
                        Cargando estad√≠sticas...
                    </p>
                </div>
            </div>

            <div class="paths-grid">
                <div class="path-card grow">
                    <div class="path-title" style="color: var(--lvl-6);">Ruta: Subir (Hacia el Violeta)</div>
                    <p style="margin-bottom: 1rem; font-style: italic;">Elevaci√≥n del conocimiento y comprensi√≥n simb√≥lica.</p>
                    <ul class="styled-list">
                        <li><strong>Distingue:</strong> Separa la superstici√≥n (miedo/lucro) de la tradici√≥n.</li>
                        <li><strong>Verifica:</strong> Busca fechas y autores. ¬øQui√©n lo invent√≥?</li>
                        <li><strong>Interpreta:</strong> Mira al duende como met√°fora de la naturaleza.</li>
                        <li><strong>Estudia:</strong> Visita archivos, no solo tiendas.</li>
                        <li><strong>Valora:</strong> Prefiere la obra de autor sobre la copia.</li>
                    </ul>
                </div>

                <div class="path-card stay">
                    <div class="path-title" style="color: var(--lvl-1);">Ruta: Bajar (Hacia el Rojo)</div>
                    <p style="margin-bottom: 1rem; font-style: italic;">Estancamiento en el instinto b√°sico y el rumor.</p>
                    <ul class="styled-list" style="opacity: 0.8;">
                        <li>Seguir compartiendo virales sin fuente.</li>
                        <li>Realizar rituales por dinero r√°pido.</li>
                        <li>Confundir vivencia subjetiva con historia real.</li>
                        <li>Miedo irracional.</li>
                        <li>Creer que "todo es verdad" sin cuestionar.</li>
                    </ul>
                </div>
            </div>

            <div class="paths-grid">
                <div style="grid-column: span 2; background: #fff; padding: 1.5rem; border: 1px solid var(--border-color); border-radius: 4px; text-align: center;">
                    <h4 style="margin-bottom: 1rem;">Caminos de Aprendizaje</h4>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
                        <span style="background:#eee; padding:5px 10px; border-radius:4px; font-size:0.9rem;">üìö C√≥mo buscar fuentes</span>
                        <span style="background:#eee; padding:5px 10px; border-radius:4px; font-size:0.9rem;">üé® El s√≠mbolo en el arte</span>
                        <span style="background:#eee; padding:5px 10px; border-radius:4px; font-size:0.9rem;">üèîÔ∏è Duende y naturaleza</span>
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 3rem; display: flex; justify-content: center; gap: 1rem;">
                <button class="btn" onclick="window.print()">Imprimir Ficha</button>
                <button class="btn btn-outline" onclick="resetQuiz()">Reiniciar Test</button>
            </div>
        </section>

    </main>

    <footer>
        <p><strong>El arte puede ser m√°gico sin necesidad de superstici√≥n.</strong></p>
        <p style="margin-top: 0.5rem;">La Casa del Duende (Fundada en 2013, Ba√±os de Agua Santa).</p>
        <p style="font-size: 0.8rem; margin-top: 1rem; opacity: 0.6;">Duendismo Cultural ¬Æ - Todos los derechos reservados.</p>
    </footer>

    <script>
        // --- CONFIGURACI√ìN DE MEMORIA ---
        const STORAGE_KEY_USER = 'duende_user_level'; 
        const STORAGE_KEY_GLOBAL = 'duende_global_stats'; 

        // Semilla inicial (Datos falsos para que el gr√°fico no empiece en 0 la primera vez)
        const INITIAL_SEED = { 
            1: 8,  // Rojo
            2: 12, // Naranja (Com√∫n)
            3: 15, // Amarillo (Com√∫n)
            4: 6,  // Verde
            5: 3,  // Azul
            6: 1   // Violeta (Raro)
        };

        // --- DATOS DEL SISTEMA ---
        const levels = {
            1: { title: "Nivel 1: Instinto / Superstici√≥n", color: "var(--lvl-1)", short: "Rojo: Base material. Creencia por lucro o miedo.", long: "Como el color rojo (frecuencia baja), este nivel se enfoca en la supervivencia e instinto: rituales de dinero o miedo a lo desconocido." },
            2: { title: "Nivel 2: El Rumor", color: "var(--lvl-2)", short: "Naranja: Emoci√≥n contagiosa sin fuente.", long: "El naranja representa la sociabilidad. Aqu√≠ el conocimiento es un rumor viral que se comparte por emoci√≥n, no por veracidad." },
            3: { title: "Nivel 3: Subjetividad", color: "var(--lvl-3)", short: "Amarillo: El Ego. 'Mi verdad' personal.", long: "El amarillo es el color del yo. Tu experiencia es v√°lida para ti, pero no es una verdad universal o hist√≥rica." },
            4: { title: "Nivel 4: Interpretaci√≥n Art√≠stica", color: "var(--lvl-4)", short: "Verde: Conexi√≥n con Naturaleza y Arte.", long: "El verde es el puente. Aqu√≠ el duende deja de ser literal y se vuelve un s√≠mbolo art√≠stico de nuestra relaci√≥n con el entorno." },
            5: { title: "Nivel 5: Tradici√≥n Cultural", color: "var(--lvl-5)", short: "Azul: Comunicaci√≥n y Legado Oral.", long: "El azul representa la palabra verdadera. Historias transmitidas con respeto y ra√≠z en la identidad de un pueblo." },
            6: { title: "Nivel 6: Conocimiento", color: "var(--lvl-6)", short: "Violeta: Sabidur√≠a y Documentaci√≥n.", long: "El violeta es la frecuencia m√°s alta. An√°lisis cr√≠tico, archivo, antropolog√≠a y comprensi√≥n profunda del fen√≥meno." }
        };

        const questions = [
            { q: "¬øCu√°l es tu fuente principal?", opts: [{ t: "Lo vi en TikTok / Me contaron.", w: 2 }, { t: "Historias de mis abuelos.", w: 6 }, { t: "Libros y archivos hist√≥ricos.", w: 10 }] },
            { q: "¬øQu√© buscas con los duendes?", opts: [{ t: "Dinero y suerte r√°pida.", w: 1 }, { t: "Curiosidad m√°gica.", w: 5 }, { t: "Entender el s√≠mbolo cultural.", w: 10 }] },
            { q: "¬øTienes una fuente verificable?", opts: [{ t: "No, pero todos lo saben.", w: 2 }, { t: "Es tradici√≥n oral.", w: 6 }, { t: "S√≠, autor y fecha.", w: 10 }] },
            { q: "¬øVivencia o Historia?", opts: [{ t: "Si lo sent√≠, es historia real.", w: 3 }, { t: "Es mi verdad personal.", w: 8 }, { t: "Distingo mi sentir del hecho hist√≥rico.", w: 10 }] },
            { q: "¬øRelaci√≥n con la naturaleza?", opts: [{ t: "Miedo al castigo.", w: 3 }, { t: "Intercambio de favores.", w: 2 }, { t: "Respeto simb√≥lico y ecol√≥gico.", w: 10 }] },
            { q: "¬øLa imagen del duende cambia?", opts: [{ t: "Son siempre iguales.", w: 2 }, { t: "Depende qui√©n cuente.", w: 5 }, { t: "Evoluciona con el arte y √©poca.", w: 10 }] },
            { q: "¬øC√≥mo te informas?", opts: [{ t: "Historias de miedo.", w: 1 }, { t: "Escuchando ancianos.", w: 6 }, { t: "Comparando libros y regiones.", w: 10 }] },
            { q: "¬øQu√© es el Duendismo Cultural?", opts: [{ t: "Un invento raro.", w: 2 }, { t: "Arte y filosof√≠a.", w: 9 }, { t: "Prefiero brujer√≠a.", w: 1 }] },
            { q: "¬øCorriges tus ideas sin fuentes?", opts: [{ t: "No, yo s√© lo que vi.", w: 1 }, { t: "A veces.", w: 6 }, { t: "S√≠, el conocimiento evoluciona.", w: 10 }] },
            { q: "¬øMisterio o Aprendizaje?", opts: [{ t: "Misterio divertido.", w: 2 }, { t: "Aprendizaje serio.", w: 10 }] }
        ];

        // --- REFERENCIAS DOM ---
        const form = document.getElementById('quiz-form');
        const quizSection = document.getElementById('quiz-section');
        const resultsSection = document.getElementById('results-section');
        const toggle = document.getElementById('modeToggle');
        const body = document.body;
        const tooltip = document.getElementById('pyramid-tooltip');
        const userMarker = document.getElementById('user-marker');
        const chartContainer = document.getElementById('distribution-chart');

        // --- INICIALIZACI√ìN ---
        window.onload = () => {
            renderQuiz();
            setupPyramid();
            
            // 1. Inicializar Memoria Global si no existe
            initGlobalStats();

            // 2. Verificar si el usuario ya hizo el test
            const savedLevel = localStorage.getItem(STORAGE_KEY_USER);
            if (savedLevel) {
                showResults(parseInt(savedLevel));
            }

            // 3. Listener Toggle
            toggle.addEventListener('change', () => {
                body.className = toggle.checked ? 'show-aula' : 'show-museo';
                document.getElementById('mode-text').textContent = toggle.checked ? "Modo Aula" : "Modo Museo";
            });
        };

        // --- L√ìGICA DE MEMORIA ---
        function initGlobalStats() {
            if (!localStorage.getItem(STORAGE_KEY_GLOBAL)) {
                localStorage.setItem(STORAGE_KEY_GLOBAL, JSON.stringify(INITIAL_SEED));
            }
        }

        function getGlobalStats() {
            return JSON.parse(localStorage.getItem(STORAGE_KEY_GLOBAL));
        }

        function updateGlobalStats(newLevel) {
            let stats = getGlobalStats();
            stats[newLevel] = (stats[newLevel] || 0) + 1;
            localStorage.setItem(STORAGE_KEY_GLOBAL, JSON.stringify(stats));
        }

        // --- L√ìGICA VISUAL ---
        function setupPyramid() {
            document.querySelectorAll('.pyramid-layer').forEach(layer => {
                layer.addEventListener('mouseenter', () => showTooltip(layer.dataset.lvl));
                layer.addEventListener('click', () => showTooltip(layer.dataset.lvl));
            });
            document.querySelector('.pyramid-svg').addEventListener('mouseleave', () => tooltip.classList.remove('visible'));
        }

        function showTooltip(id) {
            const info = levels[id];
            tooltip.innerHTML = `<strong style="color:${info.color}">${info.title}</strong><br><span class="mode-museo">${info.short}</span><span class="mode-aula">${info.long}</span>`;
            tooltip.classList.add('visible');
        }

        function renderQuiz() {
            form.innerHTML = questions.map((q, i) => `
                <div class="question-block"><div class="question-title">${i+1}. ${q.q}</div>
                <div class="options-group">${q.opts.map(o => `<label><input type="radio" name="q${i}" value="${o.w}"> ${o.t}</label>`).join('')}</div></div>
            `).join('');
        }

        function calculateResults() {
            const data = new FormData(form);
            let score = 0, count = 0;
            for(let p of data.entries()) { score += +p[1]; count++; }
            
            if(count < questions.length) return alert("Por favor, responde todas las preguntas para obtener un diagn√≥stico preciso.");
            
            const pct = (score / (questions.length * 10)) * 100;
            let lvl = 1;
            if (pct > 85) lvl = 6;
            else if (pct > 70) lvl = 5;
            else if (pct > 50) lvl = 4;
            else if (pct > 35) lvl = 3;
            else if (pct > 20) lvl = 2;

            // Guardar resultado personal
            localStorage.setItem(STORAGE_KEY_USER, lvl);
            
            // Actualizar memoria global (Solo si es la primera vez que calcula en esta sesi√≥n para no inflar datos)
            // Nota simple: aqu√≠ sumamos siempre que calcula. 
            updateGlobalStats(lvl);

            showResults(lvl);
        }

        function showResults(level) {
            quizSection.style.display = 'none';
            resultsSection.style.display = 'block';
            
            const info = levels[level];
            const badge = document.getElementById('result-badge');
            badge.style.backgroundColor = info.color;
            badge.textContent = info.title;
            document.getElementById('result-desc-short').textContent = info.short;
            document.getElementById('result-desc-long').textContent = info.long;

            // Render Chart
            renderRealChart(level);

            // Move Marker
            userMarker.style.display = 'block';
            const yPos = {6:45, 5:110, 4:170, 3:230, 2:290, 1:350};
            setTimeout(() => userMarker.setAttribute('transform', `translate(460, ${yPos[level]})`), 100);
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function renderRealChart(userLvl) {
            const stats = getGlobalStats();
            let total = 0;
            for (let k in stats) total += stats[k];

            let html = '';
            for (let i = 1; i <= 6; i++) {
                const count = stats[i] || 0;
                const pct = total > 0 ? Math.round((count / total) * 100) : 0;
                const isActive = i === userLvl ? 'active' : '';
                // Altura m√≠nima 2px para que se vea
                const height = pct > 0 ? pct * 1.5 : 2; 

                html += `
                    <div class="bar-wrapper">
                        <div class="bar-value">${pct}%</div>
                        <div class="bar ${isActive}" style="height: ${height}px; background: var(--lvl-${i});" title="${count} personas"></div>
                        <div class="bar-label">N${i}</div>
                    </div>
                `;
            }
            chartContainer.innerHTML = html;
            document.getElementById('chart-footer').innerHTML = `* Datos basados en ${total} diagn√≥sticos registrados en este equipo.`;
        }

        function resetQuiz() {
            // Borra usuario, pero MANTIENE estad√≠stica global
            localStorage.removeItem(STORAGE_KEY_USER);
            form.reset();
            quizSection.style.display = 'block';
            resultsSection.style.display = 'none';
            userMarker.style.display = 'none';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>
