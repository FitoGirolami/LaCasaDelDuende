<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Casa del Duende — Mapa del Conocimiento | Duendismo Cultural</title>
    <meta name="description" content="Descubre tu nivel de conocimiento sobre el simbolismo de los duendes. Herramienta educativa de La Casa del Duende.">
    <link rel="canonical" href="https://lacasadelduende.art/mapa-del-conocimiento.html">
    
    <meta property="og:type" content="website">
    <meta property="og:title" content="La Casa del Duende — Mapa del Conocimiento">
    <meta property="og:description" content="¿En qué nivel de la pirámide estás? Diagnóstico cultural interactivo.">
    
    <style>
        :root {
            /* Paleta: Museo / Tierra / Papel */
            --bg-paper: #f9f7f2;
            --text-ink: #2b2b2b;
            --text-light: #66605b;
            --accent-gold: #cfa86e;
            --border-color: #e0ddd5;
            
            /* TEORÍA DEL COLOR (Espectro visible: Rojo denso -> Violeta elevado) */
            --lvl-1: #b71c1c; /* Rojo: Instinto / Superstición */
            --lvl-2: #e65100; /* Naranja: Emoción / Rumor */
            --lvl-3: #f9a825; /* Amarillo Ocre: Ego / Subjetivo */
            --lvl-4: #2e7d32; /* Verde: Naturaleza / Arte */
            --lvl-5: #1565c0; /* Azul: Comunicación / Tradición */
            --lvl-6: #6a1b9a; /* Violeta: Sabiduría / Conocimiento */

            --font-heading: 'Georgia', 'Times New Roman', serif;
            --font-body: system-ui, -apple-system, sans-serif;
            
            --shadow-card: 0 4px 12px rgba(0,0,0,0.06);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background-color: var(--bg-paper);
            color: var(--text-ink);
            font-family: var(--font-body);
            line-height: 1.6;
            transition: background 0.3s ease;
        }

        /* --- Header --- */
        header {
            text-align: center;
            padding: 3rem 1rem;
            border-bottom: 1px solid var(--border-color);
            background: #fff;
            position: relative;
        }
        h1 {
            font-family: var(--font-heading);
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
        }
        .subtitle {
            font-style: italic;
            color: var(--text-light);
            font-size: 1.1rem;
        }

        /* --- Toggle Switch --- */
        .mode-toggle-container {
            position: absolute;
            top: 20px; right: 20px;
            display: flex; align-items: center; gap: 10px;
            font-size: 0.85rem;
            background: var(--bg-paper);
            padding: 8px 12px;
            border-radius: 20px;
            border: 1px solid var(--border-color);
        }
        .switch { position: relative; display: inline-block; width: 40px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 20px; }
        .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--text-ink); }
        input:checked + .slider:before { transform: translateX(20px); }

        /* --- Layout --- */
        main { max-width: 800px; margin: 0 auto; padding: 2rem 1rem; }

        /* --- Pyramid --- */
        .pyramid-wrapper {
            display: flex; flex-direction: column; align-items: center; margin-bottom: 4rem;
        }
        .pyramid-svg { width: 100%; max-width: 500px; height: auto; overflow: visible; }
        .pyramid-layer { cursor: pointer; transition: opacity 0.3s, transform 0.2s; }
        .pyramid-layer:hover { opacity: 0.85; transform: scale(1.01); }
        
        .tooltip-box {
            min-height: 100px; width: 100%; max-width: 600px; margin-top: 1rem;
            padding: 1.5rem; background: #fff; border: 1px solid var(--border-color);
            box-shadow: var(--shadow-card); border-radius: 4px; text-align: center;
            opacity: 0; transform: translateY(10px); transition: all 0.3s ease;
        }
        .tooltip-box.visible { opacity: 1; transform: translateY(0); }

        /* --- Quiz --- */
        .quiz-container { background: #fff; padding: 2rem; border-radius: 8px; box-shadow: var(--shadow-card); border: 1px solid var(--border-color); }
        .question-block { margin-bottom: 2.5rem; border-bottom: 1px solid #f0f0f0; padding-bottom: 1.5rem; }
        .question-title { font-family: var(--font-heading); font-size: 1.25rem; margin-bottom: 1rem; }
        .options-group label { display: block; margin-bottom: 0.8rem; cursor: pointer; padding: 10px; border-radius: 4px; transition: background 0.2s; }
        .options-group label:hover { background-color: #f4f4f0; }
        .options-group input { margin-right: 10px; accent-color: var(--text-ink); }

        .btn { background-color: var(--text-ink); color: #fff; border: none; padding: 12px 24px; font-size: 1rem; cursor: pointer; border-radius: 2px; transition: background 0.3s; }
        .btn:hover { background-color: #4a4a4a; }
        .btn-outline { background: transparent; border: 1px solid var(--text-ink); color: var(--text-ink); }
        .btn-outline:hover { background: #f0f0f0; }

        /* --- Results --- */
        .results-section { display: none; animation: fadeIn 0.6s ease; }
        .result-header { text-align: center; margin-bottom: 3rem; padding: 2rem; background: #fff; border: 1px solid var(--border-color); }
        .level-badge { display: inline-block; padding: 0.5rem 1.5rem; margin-top: 1rem; color: white; font-weight: bold; border-radius: 50px; font-family: var(--font-heading); font-size: 1.5rem; }

        /* --- CHART SECTION (NUEVO) --- */
        .chart-container {
            margin: 2rem 0;
            padding: 1.5rem;
            background: #fafafa;
            border-radius: 8px;
            border: 1px solid #eee;
        }
        .chart-title {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #666;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        .bar-chart {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 150px;
            gap: 4px;
        }
        .bar-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 14%;
        }
        .bar {
            width: 100%;
            border-radius: 4px 4px 0 0;
            transition: height 1s ease;
            position: relative;
            opacity: 0.3; /* Barras apagadas por defecto */
        }
        .bar.active {
            opacity: 1; /* Barra del usuario resaltada */
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
            border: 2px solid #2b2b2b;
        }
        .bar-label {
            font-size: 0.7rem;
            margin-top: 5px;
            color: #555;
        }
        .bar-value {
            font-size: 0.7rem;
            margin-bottom: 5px;
            font-weight: bold;
        }

        /* --- Paths --- */
        .paths-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 2rem; }
        .path-card { background: #fff; padding: 2rem; border-top: 4px solid #ccc; box-shadow: var(--shadow-card); }
        .path-card.grow { border-color: var(--lvl-6); }
        .path-card.stay { border-color: var(--lvl-1); }
        .path-title { font-family: var(--font-heading); margin-bottom: 1rem; font-size: 1.4rem; }
        
        ul.styled-list { list-style: none; padding: 0; }
        ul.styled-list li { margin-bottom: 0.8rem; padding-left: 1.5rem; position: relative; }
        ul.styled-list li::before { content: "—"; position: absolute; left: 0; color: var(--accent-gold); }

        /* Modes */
        .mode-aula { display: none; margin-top: 0.5rem; font-size: 0.95rem; color: #555; border-left: 2px solid var(--accent-gold); padding-left: 10px; }
        .mode-museo { display: block; }
        body.show-aula .mode-aula { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        @media (max-width: 768px) {
            .paths-grid { grid-template-columns: 1fr; }
            .mode-toggle-container { position: relative; top: 0; right: 0; margin-bottom: 1rem; justify-content: center; border: none; }
        }

        @media print {
            .mode-toggle-container, .btn, .quiz-container { display: none !important; }
            .results-section { display: block !important; }
            .bar-chart { height: 100px; }
            body { background: white; color: black; }
        }
    </style>
</head>
<body class="show-museo">

    <header>
        <div class="mode-toggle-container">
            <span id="mode-text">Modo Museo (Breve)</span>
            <label class="switch">
                <input type="checkbox" id="modeToggle">
                <span class="slider"></span>
            </label>
        </div>
        <h1>La Casa del Duende</h1>
        <div class="subtitle">Mapa del Conocimiento: Teoría del Color</div>
    </header>

    <main>
        <section class="pyramid-wrapper">
            <div id="pyramid-tooltip" class="tooltip-box">
                <p style="font-style: italic; color: #888;">Interactúa con la pirámide o realiza el test para ubicarte.</p>
            </div>

            <svg class="pyramid-svg" viewBox="0 0 500 450" xmlns="http://www.w3.org/2000/svg">
                <polygon points="250,20 300,80 200,80" fill="var(--lvl-6)" class="pyramid-layer" data-lvl="6" />
                <text x="250" y="70" text-anchor="middle" fill="white" font-size="12" font-family="sans-serif" pointer-events="none">6. Documentado</text>

                <polygon points="200,82 300,82 340,140 160,140" fill="var(--lvl-5)" class="pyramid-layer" data-lvl="5" />
                <text x="250" y="125" text-anchor="middle" fill="white" font-size="12" font-family="sans-serif" pointer-events="none">5. Tradición Oral</text>

                <polygon points="160,142 340,142 380,200 120,200" fill="var(--lvl-4)" class="pyramid-layer" data-lvl="4" />
                <text x="250" y="185" text-anchor="middle" fill="white" font-size="12" font-family="sans-serif" pointer-events="none">4. Arte / Duendismo</text>

                <polygon points="120,202 380,202 420,260 80,260" fill="var(--lvl-3)" class="pyramid-layer" data-lvl="3" />
                <text x="250" y="245" text-anchor="middle" fill="black" font-size="12" font-family="sans-serif" pointer-events="none">3. Subjetivo</text>

                <polygon points="80,262 420,262 460,320 40,320" fill="var(--lvl-2)" class="pyramid-layer" data-lvl="2" />
                <text x="250" y="305" text-anchor="middle" fill="white" font-size="12" font-family="sans-serif" pointer-events="none">2. Rumor</text>

                <polygon points="40,322 460,322 500,380 0,380" fill="var(--lvl-1)" class="pyramid-layer" data-lvl="1" />
                <text x="250" y="365" text-anchor="middle" fill="white" font-size="12" font-family="sans-serif" pointer-events="none">1. Superstición</text>

                <g id="user-marker" style="display:none; transition: transform 1s ease;">
                    <path d="M0,0 L15,8 L0,16 Z" fill="#2b2b2b" transform="translate(460, 0)"/>
                    <text x="480" y="12" font-size="14" font-weight="bold" fill="#2b2b2b">TÚ</text>
                    <line x1="460" y1="8" x2="350" y2="8" stroke="#2b2b2b" stroke-dasharray="4"/>
                </g>
            </svg>
        </section>

        <section id="quiz-section" class="quiz-container">
            <h2 style="font-family: var(--font-heading); margin-bottom: 1.5rem; text-align: center;">Diagnóstico de Conocimiento Simbólico</h2>
            <form id="quiz-form"></form>
            <div style="text-align: center; margin-top: 2rem;">
                <button type="button" class="btn" onclick="calculateResults()">Ver mi nivel</button>
            </div>
        </section>

        <section id="results-section" class="results-section">
            <div class="result-header">
                <h3>Tu diagnóstico cultural:</h3>
                <div id="result-badge" class="level-badge">CALCULANDO...</div>
                <p class="mode-museo" id="result-desc-short" style="margin-top: 1rem;"></p>
                <p class="mode-aula" id="result-desc-long"></p>

                <div class="chart-container">
                    <div class="chart-title">Comparativa con otros visitantes</div>
                    <div class="bar-chart" id="distribution-chart">
                        </div>
                    <p style="font-size: 0.8rem; color: #888; margin-top: 10px; font-style: italic;">
                        * La mayoría de las personas inicia en niveles bajos (rojo/naranja) antes de profundizar.
                    </p>
                </div>
            </div>

            <div class="paths-grid">
                <div class="path-card grow">
                    <div class="path-title" style="color: var(--lvl-6);">Ruta: Subir (Hacia el Violeta)</div>
                    <p style="margin-bottom: 1rem; font-style: italic;">Elevación del conocimiento y comprensión simbólica.</p>
                    <ul class="styled-list">
                        <li><strong>Distingue:</strong> Separa la superstición (miedo/lucro) de la tradición.</li>
                        <li><strong>Verifica:</strong> Busca fechas y autores. ¿Quién lo inventó?</li>
                        <li><strong>Interpreta:</strong> Mira al duende como metáfora de la naturaleza.</li>
                        <li><strong>Estudia:</strong> Visita archivos, no solo tiendas.</li>
                    </ul>
                </div>

                <div class="path-card stay">
                    <div class="path-title" style="color: var(--lvl-1);">Ruta: Bajar (Hacia el Rojo)</div>
                    <p style="margin-bottom: 1rem; font-style: italic;">Estancamiento en el instinto básico y el rumor.</p>
                    <ul class="styled-list" style="opacity: 0.8;">
                        <li>Seguir compartiendo virales sin fuente.</li>
                        <li>Realizar rituales por dinero rápido.</li>
                        <li>Confundir vivencia subjetiva con historia real.</li>
                        <li>Miedo irracional.</li>
                    </ul>
                </div>
            </div>

            <div style="text-align: center; margin-top: 3rem; display: flex; justify-content: center; gap: 1rem;">
                <button class="btn" onclick="window.print()">Imprimir Ficha</button>
                <button class="btn btn-outline" onclick="resetQuiz()">Reiniciar Test</button>
            </div>
        </section>
    </main>

    <footer>
        <p><strong>El arte puede ser mágico sin necesidad de superstición.</strong></p>
        <p style="margin-top: 0.5rem;">La Casa del Duende (2013, Baños de Agua Santa).</p>
        <p style="font-size: 0.8rem; margin-top: 1rem; opacity: 0.6;">Duendismo Cultural ®</p>
    </footer>

    <script>
        // --- DATOS ---
        const levels = {
            1: { title: "Nivel 1: Instinto / Superstición", color: "var(--lvl-1)", short: "Rojo: Base material. Creencia por lucro o miedo.", long: "Como el color rojo (frecuencia baja), este nivel se enfoca en la supervivencia e instinto: rituales de dinero o miedo a lo desconocido." },
            2: { title: "Nivel 2: El Rumor", color: "var(--lvl-2)", short: "Naranja: Emoción contagiosa sin fuente.", long: "El naranja representa la sociabilidad. Aquí el conocimiento es un rumor viral que se comparte por emoción, no por veracidad." },
            3: { title: "Nivel 3: Subjetividad", color: "var(--lvl-3)", short: "Amarillo: El Ego. 'Mi verdad' personal.", long: "El amarillo es el color del yo. Tu experiencia es válida para ti, pero no es una verdad universal o histórica." },
            4: { title: "Nivel 4: Interpretación Artística", color: "var(--lvl-4)", short: "Verde: Conexión con Naturaleza y Arte.", long: "El verde es el puente. Aquí el duende deja de ser literal y se vuelve un símbolo artístico de nuestra relación con el entorno." },
            5: { title: "Nivel 5: Tradición Cultural", color: "var(--lvl-5)", short: "Azul: Comunicación y Legado Oral.", long: "El azul representa la palabra verdadera. Historias transmitidas con respeto y raíz en la identidad de un pueblo." },
            6: { title: "Nivel 6: Conocimiento", color: "var(--lvl-6)", short: "Violeta: Sabiduría y Documentación.", long: "El violeta es la frecuencia más alta. Análisis crítico, archivo, antropología y comprensión profunda del fenómeno." }
        };

        // Simulación estadística de visitantes (Distribución típica)
        const visitorsStats = [
            { lvl: 1, pct: 15 },
            { lvl: 2, pct: 25 }, // La mayoría empieza aquí
            { lvl: 3, pct: 30 }, // O aquí
            { lvl: 4, pct: 15 },
            { lvl: 5, pct: 10 },
            { lvl: 6, pct: 5 }   // Pocos llegan aquí
        ];

        const questions = [
            { q: "¿Cuál es tu fuente principal?", opts: [{ t: "Lo vi en TikTok / Me contaron.", w: 2 }, { t: "Historias de mis abuelos.", w: 6 }, { t: "Libros y archivos históricos.", w: 10 }] },
            { q: "¿Qué buscas con los duendes?", opts: [{ t: "Dinero y suerte rápida.", w: 1 }, { t: "Curiosidad mágica.", w: 5 }, { t: "Entender el símbolo cultural.", w: 10 }] },
            { q: "¿Tienes una fuente verificable?", opts: [{ t: "No, pero todos lo saben.", w: 2 }, { t: "Es tradición oral.", w: 6 }, { t: "Sí, autor y fecha.", w: 10 }] },
            { q: "¿Vivencia o Historia?", opts: [{ t: "Si lo sentí, es historia real.", w: 3 }, { t: "Es mi verdad personal.", w: 8 }, { t: "Distingo mi sentir del hecho histórico.", w: 10 }] },
            { q: "¿Relación con la naturaleza?", opts: [{ t: "Miedo al castigo.", w: 3 }, { t: "Intercambio de favores.", w: 2 }, { t: "Respeto simbólico y ecológico.", w: 10 }] },
            { q: "¿La imagen del duende cambia?", opts: [{ t: "Son siempre iguales.", w: 2 }, { t: "Depende quién cuente.", w: 5 }, { t: "Evoluciona con el arte y época.", w: 10 }] },
            { q: "¿Cómo te informas?", opts: [{ t: "Historias de miedo.", w: 1 }, { t: "Escuchando ancianos.", w: 6 }, { t: "Comparando libros y regiones.", w: 10 }] },
            { q: "¿Qué es el Duendismo Cultural?", opts: [{ t: "Un invento raro.", w: 2 }, { t: "Arte y filosofía.", w: 9 }, { t: "Prefiero brujería.", w: 1 }] },
            { q: "¿Corriges tus ideas sin fuentes?", opts: [{ t: "No, yo sé lo que vi.", w: 1 }, { t: "A veces.", w: 6 }, { t: "Sí, el conocimiento evoluciona.", w: 10 }] },
            { q: "¿Misterio o Aprendizaje?", opts: [{ t: "Misterio divertido.", w: 2 }, { t: "Aprendizaje serio.", w: 10 }] }
        ];

        const form = document.getElementById('quiz-form');
        const quizSection = document.getElementById('quiz-section');
        const resultsSection = document.getElementById('results-section');
        const toggle = document.getElementById('modeToggle');
        const body = document.body;
        const tooltip = document.getElementById('pyramid-tooltip');
        const userMarker = document.getElementById('user-marker');
        const chartContainer = document.getElementById('distribution-chart');

        window.onload = () => {
            renderQuiz();
            setupPyramid();
            const savedLevel = localStorage.getItem('duendeLevel');
            if (savedLevel) showResults(parseInt(savedLevel));
            
            toggle.addEventListener('change', () => {
                body.className = toggle.checked ? 'show-aula' : 'show-museo';
                document.getElementById('mode-text').textContent = toggle.checked ? "Modo Aula" : "Modo Museo";
            });
        };

        function setupPyramid() {
            document.querySelectorAll('.pyramid-layer').forEach(layer => {
                layer.addEventListener('mouseenter', () => showTooltip(layer.dataset.lvl));
                layer.addEventListener('click', () => showTooltip(layer.dataset.lvl));
            });
            document.querySelector('.pyramid-svg').addEventListener('mouseleave', () => tooltip.classList.remove('visible'));
        }

        function showTooltip(id) {
            const info = levels[id];
            tooltip.innerHTML = `<strong style="color:${info.color}">${info.title}</strong><br><span class="mode-museo">${info.short}</span><span class="mode-aula">${info.long}</span>`;
            tooltip.classList.add('visible');
        }

        function renderQuiz() {
            form.innerHTML = questions.map((q, i) => `
                <div class="question-block"><div class="question-title">${i+1}. ${q.q}</div>
                <div class="options-group">${q.opts.map(o => `<label><input type="radio" name="q${i}" value="${o.w}"> ${o.t}</label>`).join('')}</div></div>
            `).join('');
        }

        function calculateResults() {
            const data = new FormData(form);
            let score = 0, count = 0;
            for(let p of data.entries()) { score += +p[1]; count++; }
            
            if(count < questions.length) return alert("Responde todo primero.");
            
            const pct = (score / (questions.length * 10)) * 100;
            let lvl = 1;
            if (pct > 85) lvl = 6;
            else if (pct > 70) lvl = 5;
            else if (pct > 50) lvl = 4;
            else if (pct > 35) lvl = 3;
            else if (pct > 20) lvl = 2;

            localStorage.setItem('duendeLevel', lvl);
            showResults(lvl);
        }

        function showResults(level) {
            quizSection.style.display = 'none';
            resultsSection.style.display = 'block';
            
            const info = levels[level];
            const badge = document.getElementById('result-badge');
            badge.style.backgroundColor = info.color;
            badge.textContent = info.title;
            document.getElementById('result-desc-short').textContent = info.short;
            document.getElementById('result-desc-long').textContent = info.long;

            // Update Chart
            renderChart(level);

            // Move Marker
            userMarker.style.display = 'block';
            const yPos = {6:45, 5:110, 4:170, 3:230, 2:290, 1:350};
            setTimeout(() => userMarker.setAttribute('transform', `translate(460, ${yPos[level]})`), 100);
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function renderChart(userLvl) {
            chartContainer.innerHTML = visitorsStats.map(stat => {
                const isActive = stat.lvl === userLvl ? 'active' : '';
                const color = levels[stat.lvl].color.replace('var(', '').replace(')', ''); // simple fix for inline styles usually needing real colors, but vars work in modern browsers
                // Note: using css variables inside inline style needs proper syntax or direct usage in class
                return `
                    <div class="bar-wrapper">
                        <div class="bar-value">${stat.pct}%</div>
                        <div class="bar ${isActive}" style="height: ${stat.pct * 3}px; background: var(--lvl-${stat.lvl});"></div>
                        <div class="bar-label">N${stat.lvl}</div>
                    </div>
                `;
            }).join('');
        }

        function resetQuiz() {
            localStorage.removeItem('duendeLevel');
            form.reset();
            quizSection.style.display = 'block';
            resultsSection.style.display = 'none';
            userMarker.style.display = 'none';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>
