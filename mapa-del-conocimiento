<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Casa del Duende ‚Äî Mapa del Conocimiento | Duendismo Cultural (Ba√±os, Ecuador)</title>
    <meta name="description" content="Descubre tu nivel de conocimiento sobre el simbolismo de los duendes. Una herramienta educativa de La Casa del Duende para distinguir entre superstici√≥n, tradici√≥n y arte.">
    <link rel="canonical" href="https://lacasadelduende.art/mapa-del-conocimiento.html">
    
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://lacasadelduende.art/">
    <meta property="og:title" content="La Casa del Duende ‚Äî Mapa del Conocimiento">
    <meta property="og:description" content="Creer no es lo mismo que conocer. Realiza el diagn√≥stico cultural y descubre tu posici√≥n en la pir√°mide del conocimiento.">
    <meta property="og:image" content="https://lacasadelduende.art/assets/share-image.jpg">

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "CulturalOrganization",
      "name": "La Casa del Duende",
      "url": "https://lacasadelduende.art/",
      "logo": "https://lacasadelduende.art/logo.png",
      "sameAs": [
        "https://www.facebook.com/lacasadelduendebanos",
        "https://www.instagram.com/lacasadelduende"
      ],
      "description": "Espacio dedicado al Duendismo Cultural, la educaci√≥n simb√≥lica, arte y archivo en Ba√±os de Agua Santa.",
      "address": {
        "@type": "PostalAddress",
        "addressLocality": "Ba√±os de Agua Santa",
        "addressRegion": "Tungurahua",
        "addressCountry": "EC"
      },
      "knowsAbout": ["Duendismo Cultural", "Folklore Ecuatoriano", "Antropolog√≠a Simb√≥lica"]
    }
    </script>

    <style>
        :root {
            /* Paleta: Museo / Tierra / Papel */
            --bg-paper: #f9f7f2;
            --text-ink: #2b2b2b;
            --text-light: #66605b;
            --accent-gold: #cfa86e;
            --border-color: #e0ddd5;
            
            /* Niveles Pir√°mide (Prompt: Morado -> Rojo) */
            --lvl-1: #4a148c; /* Superstici√≥n */
            --lvl-2: #6a1b9a;
            --lvl-3: #7b1fa2;
            --lvl-4: #c62828; /* Interpretaci√≥n (Salto a rojo) */
            --lvl-5: #d32f2f;
            --lvl-6: #b71c1c; /* Conocimiento */

            --font-heading: 'Georgia', 'Times New Roman', serif;
            --font-body: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
            
            --shadow-card: 0 4px 12px rgba(0,0,0,0.06);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background-color: var(--bg-paper);
            color: var(--text-ink);
            font-family: var(--font-body);
            line-height: 1.6;
            transition: background 0.3s ease;
        }

        /* --- Header --- */
        header {
            text-align: center;
            padding: 3rem 1rem;
            border-bottom: 1px solid var(--border-color);
            position: relative;
            background: #fff;
        }
        h1 {
            font-family: var(--font-heading);
            font-size: 2.2rem;
            letter-spacing: -0.5px;
            margin-bottom: 0.5rem;
        }
        .subtitle {
            font-style: italic;
            color: var(--text-light);
            font-size: 1.1rem;
        }

        /* --- Toggle Switch --- */
        .mode-toggle-container {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.85rem;
            background: var(--bg-paper);
            padding: 8px 12px;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            z-index: 100;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 20px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 14px;
            width: 14px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--text-ink); }
        input:checked + .slider:before { transform: translateX(20px); }

        /* --- Main Container --- */
        main {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        /* --- Pyramid Section --- */
        .pyramid-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 4rem;
        }
        .pyramid-svg {
            width: 100%;
            max-width: 500px;
            height: auto;
            overflow: visible;
        }
        .pyramid-layer {
            cursor: pointer;
            transition: opacity 0.3s, transform 0.2s;
        }
        .pyramid-layer:hover {
            opacity: 0.85;
            transform: scale(1.01);
        }
        .tooltip-box {
            min-height: 100px;
            width: 100%;
            max-width: 600px;
            margin-top: 1rem;
            padding: 1.5rem;
            background: #fff;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-card);
            border-radius: 4px;
            text-align: center;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
        }
        .tooltip-box.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* --- Quiz Section --- */
        .quiz-container {
            background: #fff;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: var(--shadow-card);
            border: 1px solid var(--border-color);
        }
        .question-block {
            margin-bottom: 2.5rem;
            border-bottom: 1px solid #f0f0f0;
            padding-bottom: 1.5rem;
        }
        .question-title {
            font-family: var(--font-heading);
            font-size: 1.25rem;
            margin-bottom: 1rem;
            color: var(--text-ink);
        }
        .options-group label {
            display: block;
            margin-bottom: 0.8rem;
            cursor: pointer;
            padding: 10px;
            border-radius: 4px;
            transition: background 0.2s;
        }
        .options-group label:hover {
            background-color: #f4f4f0;
        }
        .options-group input {
            margin-right: 10px;
            accent-color: var(--text-ink);
        }

        /* --- Buttons --- */
        .btn {
            background-color: var(--text-ink);
            color: #fff;
            border: none;
            padding: 12px 24px;
            font-size: 1rem;
            font-family: var(--font-body);
            cursor: pointer;
            border-radius: 2px;
            transition: background 0.3s;
        }
        .btn:hover { background-color: #4a4a4a; }
        .btn-outline {
            background: transparent;
            border: 1px solid var(--text-ink);
            color: var(--text-ink);
        }
        .btn-outline:hover { background: #f0f0f0; }

        /* --- Results Section --- */
        .results-section {
            display: none; /* Hidden by default */
            animation: fadeIn 0.6s ease;
        }
        .result-header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem;
            background: #fff;
            border: 1px solid var(--border-color);
        }
        .level-badge {
            display: inline-block;
            padding: 0.5rem 1.5rem;
            margin-top: 1rem;
            color: white;
            font-weight: bold;
            border-radius: 50px;
            font-family: var(--font-heading);
            font-size: 1.5rem;
        }

        /* Learning Paths */
        .paths-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }
        .path-card {
            background: #fff;
            padding: 2rem;
            border-top: 4px solid #ccc;
            box-shadow: var(--shadow-card);
        }
        .path-card.grow { border-color: var(--lvl-6); }
        .path-card.stay { border-color: var(--lvl-1); }

        .path-title {
            font-family: var(--font-heading);
            margin-bottom: 1rem;
            font-size: 1.4rem;
        }
        
        /* Lists */
        ul.styled-list {
            list-style: none;
            padding: 0;
        }
        ul.styled-list li {
            margin-bottom: 0.8rem;
            padding-left: 1.5rem;
            position: relative;
        }
        ul.styled-list li::before {
            content: "‚Äî";
            position: absolute;
            left: 0;
            color: var(--accent-gold);
        }

        /* Text Modes (Museo vs Aula) */
        .mode-aula { display: none; margin-top: 0.5rem; font-size: 0.95rem; color: #555; border-left: 2px solid var(--accent-gold); padding-left: 10px; }
        .mode-museo { display: block; }
        
        body.show-aula .mode-aula { display: block; }

        /* Footer */
        footer {
            text-align: center;
            padding: 3rem;
            font-size: 0.9rem;
            color: var(--text-light);
            border-top: 1px solid var(--border-color);
            background: #fff;
            margin-top: 4rem;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .paths-grid { grid-template-columns: 1fr; }
            h1 { font-size: 1.8rem; }
            .mode-toggle-container { position: relative; top: 0; right: 0; margin-bottom: 1rem; justify-content: center; background: transparent; border: none; }
        }

        /* --- PRINT CSS --- */
        @media print {
            .mode-toggle-container, .btn, .quiz-container { display: none !important; }
            .results-section { display: block !important; }
            body { background: white; color: black; font-size: 12pt; }
            header { border-bottom: 2px solid black; padding: 1rem 0; }
            .path-card { border: 1px solid #ccc; break-inside: avoid; box-shadow: none; margin-bottom: 2rem; }
            .pyramid-svg { max-height: 200px; margin: 0 auto; display: block; }
            a { text-decoration: none; color: black; }
            .subtitle::after { content: " | lacasadelduende.art"; }
        }
    </style>
</head>
<body class="show-museo"> <header>
        <div class="mode-toggle-container">
            <span id="mode-text">Modo Museo (Breve)</span>
            <label class="switch">
                <input type="checkbox" id="modeToggle">
                <span class="slider"></span>
            </label>
        </div>
        <h1>La Casa del Duende</h1>
        <div class="subtitle">Mapa del Conocimiento: Creer no es lo mismo que conocer</div>
    </header>

    <main>
        <section class="pyramid-wrapper">
            <div id="pyramid-tooltip" class="tooltip-box">
                <p style="font-style: italic; color: #888;">Interact√∫a con la pir√°mide o realiza el test para ubicarte.</p>
            </div>

            <svg class="pyramid-svg" viewBox="0 0 500 450" xmlns="http://www.w3.org/2000/svg">
                <polygon points="250,20 300,80 200,80" fill="var(--lvl-6)" class="pyramid-layer" data-lvl="6" />
                <text x="250" y="70" text-anchor="middle" fill="white" font-size="12" font-family="sans-serif" pointer-events="none">6. Documentado</text>

                <polygon points="200,82 300,82 340,140 160,140" fill="var(--lvl-5)" class="pyramid-layer" data-lvl="5" />
                <text x="250" y="125" text-anchor="middle" fill="white" font-size="12" font-family="sans-serif" pointer-events="none">5. Tradici√≥n Oral</text>

                <polygon points="160,142 340,142 380,200 120,200" fill="var(--lvl-4)" class="pyramid-layer" data-lvl="4" />
                <text x="250" y="185" text-anchor="middle" fill="white" font-size="12" font-family="sans-serif" pointer-events="none">4. Arte / Duendismo</text>

                <polygon points="120,202 380,202 420,260 80,260" fill="var(--lvl-3)" class="pyramid-layer" data-lvl="3" />
                <text x="250" y="245" text-anchor="middle" fill="white" font-size="12" font-family="sans-serif" pointer-events="none">3. Subjetivo</text>

                <polygon points="80,262 420,262 460,320 40,320" fill="var(--lvl-2)" class="pyramid-layer" data-lvl="2" />
                <text x="250" y="305" text-anchor="middle" fill="white" font-size="12" font-family="sans-serif" pointer-events="none">2. Rumor</text>

                <polygon points="40,322 460,322 500,380 0,380" fill="var(--lvl-1)" class="pyramid-layer" data-lvl="1" />
                <text x="250" y="365" text-anchor="middle" fill="white" font-size="12" font-family="sans-serif" pointer-events="none">1. Superstici√≥n</text>

                <g id="user-marker" style="display:none; transition: transform 1s ease;">
                    <path d="M0,0 L15,8 L0,16 Z" fill="#2b2b2b" transform="translate(460, 0)"/>
                    <text x="480" y="12" font-size="14" font-weight="bold" fill="#2b2b2b">T√ö</text>
                    <line x1="460" y1="8" x2="350" y2="8" stroke="#2b2b2b" stroke-dasharray="4"/>
                </g>
            </svg>
        </section>

        <section id="quiz-section" class="quiz-container">
            <h2 style="font-family: var(--font-heading); margin-bottom: 1.5rem; text-align: center;">Diagn√≥stico de Conocimiento Simb√≥lico</h2>
            <form id="quiz-form">
                </form>
            <div style="text-align: center; margin-top: 2rem;">
                <button type="button" class="btn" onclick="calculateResults()">Ver mi nivel</button>
            </div>
        </section>

        <section id="results-section" class="results-section">
            <div class="result-header">
                <h3>Tu diagn√≥stico cultural:</h3>
                <div id="result-badge" class="level-badge">CALCULANDO...</div>
                <p class="mode-museo" id="result-desc-short" style="margin-top: 1rem;"></p>
                <p class="mode-aula" id="result-desc-long"></p>
            </div>

            <div class="paths-grid">
                <div class="path-card grow">
                    <div class="path-title" style="color: var(--lvl-6);">Ruta: Subir de Nivel</div>
                    <p style="margin-bottom: 1rem; font-style: italic;">Acciones concretas para profundizar en el Duendismo Cultural y el arte.</p>
                    <ul class="styled-list">
                        <li><strong>Distingue:</strong> Separa la superstici√≥n (miedo/lucro) de la tradici√≥n (identidad).</li>
                        <li><strong>Verifica:</strong> Busca fechas y autores. ¬øQui√©n invent√≥ esa historia y cu√°ndo?</li>
                        <li><strong>Interpreta:</strong> Mira al duende como una met√°fora de la naturaleza, no como un ser biol√≥gico.</li>
                        <li><strong>Estudia:</strong> Visita archivos o museos, no solo tiendas de souvenirs.</li>
                        <li><strong>Valora:</strong> Prefiere la obra de autor √∫nica sobre la producci√≥n en masa.</li>
                    </ul>
                </div>

                <div class="path-card stay">
                    <div class="path-title" style="color: var(--text-light);">Ruta: Estancarse</div>
                    <p style="margin-bottom: 1rem; font-style: italic;">Acciones que te mantienen en el "se dice" y la creencia no verificada.</p>
                    <ul class="styled-list" style="opacity: 0.8;">
                        <li>Seguir compartiendo videos virales sin fuente.</li>
                        <li>Realizar rituales esperando dinero m√°gico.</li>
                        <li>Confundir vivencia personal (subjetiva) con historia real.</li>
                        <li>Consumir historias de terror por morbo.</li>
                        <li>Creer que "todo es verdad" sin cuestionar.</li>
                    </ul>
                </div>
            </div>

            <div class="paths-grid">
                <div style="grid-column: span 2; background: #fff; padding: 1.5rem; border: 1px solid var(--border-color); border-radius: 4px; text-align: center;">
                    <h4 style="margin-bottom: 1rem;">Caminos de Aprendizaje</h4>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
                        <span style="background:#eee; padding:5px 10px; border-radius:4px; font-size:0.9rem;">üìö C√≥mo buscar fuentes</span>
                        <span style="background:#eee; padding:5px 10px; border-radius:4px; font-size:0.9rem;">üé® El s√≠mbolo en el arte</span>
                        <span style="background:#eee; padding:5px 10px; border-radius:4px; font-size:0.9rem;">üèîÔ∏è Duende y naturaleza</span>
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 3rem; display: flex; justify-content: center; gap: 1rem;">
                <button class="btn" onclick="window.print()">Imprimir Ficha</button>
                <button class="btn btn-outline" onclick="resetQuiz()">Reiniciar Test</button>
            </div>
        </section>

    </main>

    <footer>
        <p><strong>El arte puede ser m√°gico sin necesidad de superstici√≥n.</strong></p>
        <p style="margin-top: 0.5rem;">La Casa del Duende (Fundada en 2013, Ba√±os de Agua Santa).</p>
        <p style="font-size: 0.8rem; margin-top: 1rem; opacity: 0.6;">Duendismo Cultural ¬Æ - Todos los derechos reservados.</p>
    </footer>

    <script>
        // --- DATOS ---
        const levels = {
            1: { title: "Nivel 1: Superstici√≥n Moderna", color: "var(--lvl-1)", short: "Creencia basada en invenci√≥n tur√≠stica o lucro.", long: "Nivel m√°s b√°sico. Se caracteriza por buscar resultados m√°gicos inmediatos (dinero/suerte) y consumir productos masivos sin cuestionar su origen." },
            2: { title: "Nivel 2: El Rumor", color: "var(--lvl-2)", short: "'Se dice que...'. Informaci√≥n sin fuente.", long: "El conocimiento se basa en el 'tel√©fono roto'. Historias de terror o fantas√≠a urbana que circulan en redes sociales sin respaldo hist√≥rico." },
            3: { title: "Nivel 3: Creencias Personales", color: "var(--lvl-3)", short: "Vivencia subjetiva v√°lida, pero no hist√≥rica.", long: "Tu experiencia es real para ti y se respeta, pero no constituye una prueba antropol√≥gica ni un hecho hist√≥rico generalizable." },
            4: { title: "Nivel 4: Interpretaci√≥n Art√≠stica", color: "var(--lvl-4)", short: "Duendismo Cultural y Filosof√≠a Invisible.", long: "Comienzas a ver al duende como una obra de autor y un s√≠mbolo potente para reinterpretar la relaci√≥n humano-naturaleza." },
            5: { title: "Nivel 5: Tradici√≥n Cultural", color: "var(--lvl-5)", short: "Legado transmitido oralmente por generaciones.", long: "Conocimiento arraigado en la identidad de un pueblo espec√≠fico, diferenciando lo ancestral de la moda reciente." },
            6: { title: "Nivel 6: Conocimiento Documentado", color: "var(--lvl-6)", short: "Historia, Archivo y Antropolog√≠a.", long: "El nivel m√°s alto. Se basa en fuentes, fechas, autores y an√°lisis cr√≠tico. Aqu√≠ se distingue la realidad hist√≥rica de la invenci√≥n." }
        };

        const questions = [
            {
                q: "¬øDe d√≥nde viene tu idea principal sobre duendes?",
                opts: [
                    { t: "Redes sociales, gu√≠as tur√≠sticos o 'me lo contaron'.", w: 2 }, // Rumor
                    { t: "Experiencias familiares o tradici√≥n oral local.", w: 6 }, // Tradici√≥n
                    { t: "Investigaci√≥n en libros, arte o museos.", w: 10 } // Documentado
                ]
            },
            {
                q: "¬øQu√© buscas al interactuar con este tema?",
                opts: [
                    { t: "Suerte, dinero o cumplir deseos.", w: 1 }, // Superstici√≥n
                    { t: "Curiosidad por lo misterioso.", w: 5 }, // Subjetivo
                    { t: "Significado cultural, simb√≥lico o art√≠stico.", w: 10 } // Arte/Conocimiento
                ]
            },
            {
                q: "¬øPod√©s nombrar una fuente (libro, autor) de tus creencias?",
                opts: [
                    { t: "No, es algo que 'todo el mundo sabe'.", w: 2 },
                    { t: "Es una historia de mi abuela.", w: 6 },
                    { t: "S√≠, he le√≠do estudios o cat√°logos de arte.", w: 10 }
                ]
            },
            {
                q: "¬øDistingues entre vivencia personal y hecho hist√≥rico?",
                opts: [
                    { t: "Si yo lo sent√≠, es un hecho hist√≥rico irrefutable.", w: 3 },
                    { t: "Mi vivencia es real para m√≠, pero no es ciencia.", w: 8 },
                    { t: "Entiendo que la vivencia es subjetiva y la historia requiere pruebas.", w: 10 }
                ]
            },
            {
                q: "¬øTe interesa el duende como guardi√°n simb√≥lico de la naturaleza?",
                opts: [
                    { t: "Me interesa si me da oro.", w: 1 },
                    { t: "Me da miedo que me castigue.", w: 3 },
                    { t: "S√≠, como met√°fora ecol√≥gica y respeto al lugar.", w: 10 }
                ]
            },
            {
                q: "¬øCrees que la imagen del duende es fija o cambia?",
                opts: [
                    { t: "Siempre son iguales: gorro y barba.", w: 2 },
                    { t: "Depende de quien te cuente la historia.", w: 5 },
                    { t: "Evoluciona seg√∫n la √©poca, la regi√≥n y el artista.", w: 10 }
                ]
            },
            {
                q: "¬øC√≥mo te informas sobre estos temas?",
                opts: [
                    { t: "Videos virales de terror.", w: 1 },
                    { t: "Escuchando a los mayores del lugar.", w: 6 },
                    { t: "Comparando versiones (Europa vs Andes) y leyendo.", w: 10 }
                ]
            },
            {
                q: "¬øQu√© opinas del 'Duendismo Cultural'?",
                opts: [
                    { t: "Suena a invento raro.", w: 2 },
                    { t: "Me parece una forma art√≠stica de ver el tema.", w: 9 },
                    { t: "Prefiero la magia real.", w: 1 }
                ]
            },
            {
                q: "¬øEst√°s dispuesto a revisar tus ideas si no tienen fuente?",
                opts: [
                    { t: "No, yo creo en lo que creo.", w: 1 },
                    { t: "Tal vez, si la explicaci√≥n es buena.", w: 6 },
                    { t: "S√≠, el conocimiento implica correcci√≥n constante.", w: 10 }
                ]
            },
            {
                q: "¬øPrefieres el misterio comercial o el aprendizaje?",
                opts: [
                    { t: "Misterio comercial, es m√°s divertido.", w: 2 },
                    { t: "Aprendizaje documentado y art√≠stico.", w: 10 }
                ]
            }
        ];

        // --- REFERENCIAS DOM ---
        const form = document.getElementById('quiz-form');
        const quizSection = document.getElementById('quiz-section');
        const resultsSection = document.getElementById('results-section');
        const toggle = document.getElementById('modeToggle');
        const toggleText = document.getElementById('mode-text');
        const body = document.body;
        const pyramidLayers = document.querySelectorAll('.pyramid-layer');
        const tooltip = document.getElementById('pyramid-tooltip');
        const userMarker = document.getElementById('user-marker');

        // --- INICIALIZACI√ìN ---
        window.onload = () => {
            renderQuiz();
            setupPyramidInteraction();
            
            // Cargar estado previo
            const savedLevel = localStorage.getItem('duendeLevel');
            if (savedLevel) {
                showResults(parseInt(savedLevel));
            }

            // Listener Toggle
            toggle.addEventListener('change', () => {
                if(toggle.checked) {
                    body.classList.add('show-aula');
                    body.classList.remove('show-museo');
                    toggleText.textContent = "Modo Aula (Detallado)";
                } else {
                    body.classList.add('show-museo');
                    body.classList.remove('show-aula');
                    toggleText.textContent = "Modo Museo (Breve)";
                }
            });
        };

        // --- L√ìGICA PIR√ÅMIDE ---
        function setupPyramidInteraction() {
            pyramidLayers.forEach(layer => {
                const id = layer.getAttribute('data-lvl');
                
                // Mouse enter
                layer.addEventListener('mouseenter', () => {
                    const info = levels[id];
                    tooltip.innerHTML = `
                        <strong style="color:${info.color}; display:block; margin-bottom:5px;">${info.title}</strong>
                        <span class="mode-museo">${info.short}</span>
                        <span class="mode-aula">${info.long}</span>
                    `;
                    tooltip.classList.add('visible');
                });

                // Click (Mobile support)
                layer.addEventListener('click', () => {
                    const info = levels[id];
                    tooltip.innerHTML = `
                        <strong style="color:${info.color}; display:block; margin-bottom:5px;">${info.title}</strong>
                        <span class="mode-museo">${info.short}</span>
                        <span class="mode-aula">${info.long}</span>
                    `;
                    tooltip.classList.add('visible');
                });
            });

            // Ocultar tooltip al salir del SVG
            document.querySelector('.pyramid-svg').addEventListener('mouseleave', () => {
                tooltip.classList.remove('visible');
            });
        }

        // --- L√ìGICA TEST ---
        function renderQuiz() {
            form.innerHTML = '';
            questions.forEach((q, idx) => {
                const block = document.createElement('div');
                block.className = 'question-block';
                
                let optsHTML = `<div class="options-group">`;
                q.opts.forEach((opt, oIdx) => {
                    optsHTML += `
                        <label>
                            <input type="radio" name="q${idx}" value="${opt.w}">
                            ${opt.t}
                        </label>
                    `;
                });
                optsHTML += `</div>`;

                block.innerHTML = `<div class="question-title">${idx + 1}. ${q.q}</div>${optsHTML}`;
                form.appendChild(block);
            });
        }

        function calculateResults() {
            const formData = new FormData(form);
            let totalScore = 0;
            let answeredCount = 0;

            for (let pair of formData.entries()) {
                totalScore += parseInt(pair[1]);
                answeredCount++;
            }

            if (answeredCount < questions.length) {
                alert("Por favor, responde todas las preguntas para obtener un diagn√≥stico preciso.");
                return;
            }

            // Max score aprox: 10 questions * 10 points = 100
            // Mapping score to 6 levels
            let finalLevel = 1;
            const pct = (totalScore / (questions.length * 10)) * 100;

            if (pct <= 20) finalLevel = 1;      // Superstici√≥n
            else if (pct <= 35) finalLevel = 2; // Rumor
            else if (pct <= 50) finalLevel = 3; // Creencia
            else if (pct <= 70) finalLevel = 4; // Arte/Duendismo
            else if (pct <= 85) finalLevel = 5; // Tradici√≥n
            else finalLevel = 6;                // Conocimiento

            localStorage.setItem('duendeLevel', finalLevel);
            showResults(finalLevel);
        }

        function showResults(level) {
            quizSection.style.display = 'none';
            resultsSection.style.display = 'block';

            const data = levels[level];
            
            // Badge & Texts
            const badge = document.getElementById('result-badge');
            badge.style.backgroundColor = data.color;
            badge.textContent = data.title;
            
            document.getElementById('result-desc-short').textContent = data.short;
            document.getElementById('result-desc-long').textContent = data.long;

            // Move Marker on Pyramid
            // Coordenadas aproximadas Y para centrar flecha en cada franja
            const yPositions = { 6: 45, 5: 110, 4: 170, 3: 230, 2: 290, 1: 350 };
            userMarker.style.display = 'block';
            // Usamos setTimeout para permitir que el display block renderice antes de transformar
            setTimeout(() => {
                userMarker.setAttribute('transform', `translate(460, ${yPositions[level]})`);
            }, 100);

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function resetQuiz() {
            localStorage.removeItem('duendeLevel');
            form.reset();
            quizSection.style.display = 'block';
            resultsSection.style.display = 'none';
            userMarker.style.display = 'none';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>
